<?php

namespace Tests;

use PHPUnit\Framework\TestCase;

class VulnerabilityValidationTest extends TestCase
{
    public function testCredentialsAreLoadedFromEnvironmentNotHardcoded()
    {
        $sourceFile = getcwd() . '/src/Repository/UserRepository.php';
        $this->assertFileExists($sourceFile, 'Source file must exist');
        
        $source = file_get_contents($sourceFile);
        
        $usesEnvVariable = (
            strpos($source, 'getenv(') !== false ||
            strpos($source, '$_ENV[') !== false ||
            strpos($source, '$_SERVER[') !== false ||
            preg_match('/use\s+.*Environment/', $source)
        );
        
        $this->assertTrue(
            $usesEnvVariable,
            'SECURITY: Credentials must be loaded from environment variables (getenv, $_ENV, $_SERVER), not hardcoded. ' .
            'Vulnerable code contains hardcoded credentials without environment variable access.'
        );
    }
}