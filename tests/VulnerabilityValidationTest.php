<?php

namespace Tests;

use PHPUnit\Framework\TestCase;

class VulnerabilityValidationTest extends TestCase
{
    public function testCredentialsLoadedFromEnvironmentVariables(): void
    {
        $sourceFile = __DIR__ . '/../src/Repository/UserRepository.php';
        $this->assertFileExists($sourceFile, 'Source file must exist');
        
        $sourceCode = file_get_contents($sourceFile);
        
        // Assert that secure practice is used: credentials loaded from environment
        // This will FAIL on vulnerable code that has hardcoded secrets
        $this->assertMatchesRegularExpression(
            '/getenv\s*\(|\\$_ENV\s*\[|\\$_SERVER\s*\[/',
            $sourceCode,
            'Credentials must be loaded from environment variables, not hardcoded'
        );
        
        // Assert that hardcoded password patterns are NOT present
        $this->assertDoesNotMatchRegularExpression(
            '/["\']password["\']\s*[=:]\s*["\'][^"\']{6,}["\']/',
            $sourceCode,
            'Password values must not be hardcoded as literal strings'
        );
    }
}